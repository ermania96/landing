$("#login-form").submit(function(t) {
    $("#login-submit").prop("disabled", !0), $("#login-loading").show();
    var e = $(this).serializeArray();
    $.ajax({
        url: base_url + 'user_login',
        type: "POST",
        data: e,
        dataType: "json",
        success: function(t) {
            0 == t.status && ($("#error-message").show(), $("#error-message").text(t.message), $("#login-submit").removeAttr("disabled"), $("#login-loading").hide()), 1 == t.status && window.location.reload()
        }
    }), t.preventDefault()
}), $("#register-form").submit(function(t) {
    $("#register-submit").prop("disabled", !0), $("#register-loading").show();
    var e = $(this).serializeArray();
    $.ajax({
        url: base_url + 'user_register',
        type: "POST",
        data: e,
        dataType: "json",
        success: function(t) {
            0 == t.status && ($("#error-reg-message").show(), $("#error-reg-message").html(t.message), $("#register-submit").removeAttr("disabled"), $("#register-loading").hide(),grecaptcha.reset(widgetReg)), 1 == t.status && window.location.reload()
        }
    }), t.preventDefault()
}), $("#forgot-form").submit(function(t) {
    $("#forgot-form button").text("Sending..."), $("#forgot-form button").prop("disabled", !0);
    var e = $(this).serializeArray();
    $.ajax({
        url: base_url + "user_forgot",
        type: "POST",
        data: e,
        dataType: "json",
        success: function(t) {
            0 == t.status && ($("#forgot-success-message").hide(), $("#forgot-error-message").show(), $("#forgot-error-message").html(t.message), $("#forgot-form button").text("Sent"), $("#forgot-form button").prop("disabled", !1),grecaptcha.reset(widgetForgot)), 1 == t.status && ($("#forgot-success-message").show(), $("#forgot-success-message").html(t.message), $("#forgot-error-message").hide(), $("#forgot-form button").text("Sent"), $("#forgot-form button").prop("disabled", !1))
        }
    }), t.preventDefault()
});
$(document).ready(function () {
    $.ajax({
        url: base_url + 'user_get_state',
        type: 'GET',
        dataType: 'json',
        success: function (data) {
            if (data.is_login == 1) {
				$('#top-user').html(data.content);
                is_login = true;
                $('#pop-register,#pop-login').remove();
            }
        }
    });
});
// User get notify header
function get_favorite() {
    if ($('#list-notify .notify-item').length == 0) {
        $.ajax({
            url: base_url + 'user_get_favorite',
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                if (data.status == 1) {
                    $('#notify-loading').remove();
                    $('#list-notify').html(data.html);
                    if (data.notify_unread > 0) {
                        $('.feed-number').text(data.notify_unread);
                    } else {
                        $('.feed-number').text('');
                    }
                }
            }
        })
    }
}
function movies_by_top(id) {
	if($('#movies-'+id).html().length == 0) {
		$('#movies-'+id).html('<div class="cssload-center"><div class="cssload"><span></span></div></div>');
		$.ajax({
			url: '/index.php',
			type: "POST",
			data: 'postid=movies_by_top&name='+id,
			success: function (data) {
				$('#movies-'+id).html(data);
				$(".jt").cluetip({positionBy: 'fixed'});
				$('#movies-'+id+' img.lazy').lazyload({effect : "fadeIn"});
			}
		});
	}
}
function movies_by_genre(id) {
	if($('#latest-'+id).html().length == 0) {
		$('#latest-'+id).html('<div class="cssload-center"><div class="cssload"><span></span></div></div>');
		$.ajax({
			url: '/index.php',
			type: "POST",
			data: 'postid=movies_by_genre&name='+id,
			success: function (data) {
				$('#latest-'+id).html(data);
				$(".jt").cluetip({positionBy: 'fixed'});
				$('#latest-'+id+' img.lazy').lazyload({effect : "fadeIn"});
			}
		});
	}
}
function movies_by_country(id) {
	if($('#latest-'+id).html().length == 0) {
		$('#latest-'+id).html('<div class="cssload-center"><div class="cssload"><span></span></div></div>');
		$.ajax({
			url: '/index.php',
			type: "POST",
			data: 'postid=movies_by_country&name='+id,
			success: function (data) {
				$('#latest-'+id).html(data);
				$(".jt").cluetip({positionBy: 'fixed'});
				$('#latest-'+id+' img.lazy').lazyload({effect : "fadeIn"});
			}
		});
	}
}

function subtitles_show() {
	$('#pop-subtitles').modal('show');
	return false;
}
function download_show() {
	$('#pop-download').modal('show');
	//$.get(is_download+"/?timeLimit",function() {});
	return false;
}
function trailer_url() {
	$('#pop-trailer').modal('show');
	$('#iframe-trailer').attr('src',$('input[name="trailer_url"]').val());
	$('#pop-trailer').on('hidden.bs.modal', function () {
		$('#iframe-trailer').removeAttr('src');
	});
	return false;
}
function go_request() {
	if(is_login) {
		window.location	=	'/request.html';
	}else {
		$('#pop-login').modal('show');
	}
	return false;
}
function request_form() {
	if(is_login) {
		var postData = $('#request-form').serializeArray();
		$("#request-loading").show();
		$("#request-submit").prop("disabled", true);
		$.ajax({
			url: base_url + 'request',
			type: "POST",
			data: postData,
			dataType: "json",
			success: function (data) {
				if (data.status == 0) {
					$('#message-success').addClass('alert-danger').text(data.message).show();
					$("#request-submit").removeAttr("disabled");
					$("#request-loading").hide();
					grecaptcha.reset(widgetRequest);
				}
				if (data.status == 1) {
					$('#message-success').removeClass('alert-danger').text('Request success. Thanks you!').show();
					setTimeout(function(){window.location.reload()},1500);
				}
			}
		});
	}
    return false;
}
function ratingx() {
	var phimid	=	$('input[name="phimid"]').val();
	$.post("/ajax.php",{
		'post':'rating',
		'phimid': phimid
	}, function(total){
		$('div.mv-rating').html(
			'<input type="text" class="kv-fa rating-loading hidden" value="'+total+'" data-size="xs">'+
			'<span itemprop="rating" itemscope="" itemtype="http://data-vocabulary.org/Rating" class="rating-show">'+
                '<span itemprop="average">'+total+'</span>'+
                '<meta content="5" itemprop="best">'+
                '<meta content="1" itemprop="worst">'+
            '</span>'
		);
		$('.kv-fa').rating({
			theme: 'krajee-fa',
			filledStar: '<i class="fa fa-star"></i>',
			emptyStar: '<i class="fa fa-star-o"></i>'
		});
		$('.kv-fa').on('change',function () {
			if(is_login) {
				$.post("/ajax.php",{
					'post':'rate',
					'rating': $(this).val(),
					'phimid': phimid
				}, function(data){
					//$('.kv-fa').rating('clear');
				});
			}else {
				$('#pop-login').modal('show');
			}
		});
	});
}

// Search movie
var hidden = true;
$('.search-suggest').mouseover(function () {
    hidden = false;
});

$('.search-suggest').mouseout(function () {
    hidden = true;
});

$('input[name=keyword]').keyup(function () {
    var keyword = $(this).val();
    if (keyword.trim().length > 2) {
        $.ajax({
            url: base_url + 'movie_suggest_search',
            type: 'POST',
            dataType: 'json',
            data: {q: keyword},
            success: function (data) {
                $('.search-suggest').html(data.content);
                if (data.content.trim() !== '') {
                    $('.search-suggest').show();
                } else {
                    $('.search-suggest').hide();
                }
            }
        })
    } else {
        $('.search-suggest').hide();
    }
});
$('input[name=keyword]').blur(function () {
    if (hidden) {
        $('.search-suggest').hide();
    }
});
$('input[name=keyword]').focus(function () {
    if ($('.search-suggest').html() !== '') {
        $('.search-suggest').show();
    }
});

$('input[name=keyword]').keypress(function (event) {
    if (event.which == 13) {
        searchMovie();
    }
});

function searchMovie() {
    var keyword = $('input[name=keyword]').val();
    if (keyword.trim() !== '') {
        //keyword = keyword.replace(/(<([^>]+)>)/ig, "").replace(/[`~!@#$%^&*()_|\=?;:'",.<>\{\}\[\]\\\/]/gi, "");
        keyword = keyword.split(" ").join("+");
        window.location.href = '/search/' + keyword + '.html';
    }
}
function favorite_add(e,j,i) {
	if(is_login) {
		var text_fav	=	$(j).text();
		if(text_fav=='Add to favorite' || text_fav=='Favorite') {
			var f = {
				post: 'fav',
				add_id: e,
				remove_id: 0,
			};
			$(".btn-favorite-"+e).html('<i class="fa fa-remove mr10"></i>Remove favorite');
		}else {
			var f = {
				post: 'fav',
				add_id: 0,
				remove_id: e,
			};
			$(".btn-favorite-"+e).html('<i class="fa fa-heart mr10"></i>Favorite');
		}
		$.post('/ajax.php', f);
	}else {
		$('#pop-login').modal('show');
	}
}
function filter() {
	var	url	=	'';
	var fields = $("#form_filter").serializeArray();
    $.each(fields, function(i,x) {
		if(x.value!='') {
			url	+=	((url=='')?'?':'&')+x.name+'='+x.value;
		}
    });
    window.location	=	$("#form_filter").attr('action')+url;
	return false;
}
function favorite_remove(e) {
    if(is_login) {
		var f = {
			post: 'fav',
			add_id: 0,
			remove_id: e,
		};
		$.post('/ajax.php', f);
		$("#pl_" + e).remove();
	}else {
		$('#pop-login').modal('show');
	}
	return false;
}
